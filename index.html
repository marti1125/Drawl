<!DOCTYPE html>
<html>
<!--
    Exchange the line above for this to enable offline support
    <html manifest="manifest.appcache">

    Please make your homework before doing this:
        http://www.alistapart.com/articles/application-cache-is-a-douchebag/
        http://appcachefacts.info

    This might be necessary to set up on your server, to make sure
    files are updated when the appcache file itself is:
        https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/.htaccess
 -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale = 1.0, maximum-scale = 1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <link rel="stylesheet" type="text/css" href="css/base.css">
    <!-- <link rel="stylesheet" type="text/css" href="css/headers.css"> -->
    <!-- <link rel="stylesheet" type="text/css" href="css/buttons.css"> -->
    <link rel="stylesheet" type="text/css" href="css/toolbars.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/grid.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/styles.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/slider.css" rel="stylesheet">
    <!-- iPhone (Retina) -->
    <link href="http://www.example.com/mobile/images/apple-startup-iPhone-RETINA.jpg" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">

    <!-- iPhone 5 -->
    <link href="http://www.example.com/mobile/images/apple-startup-iPhone-Tall-RETINA.jpg"  media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">

    <!-- iPad Portrait -->
    <link href="http://www.example.com/mobile/images/apple-startup-iPad-Portrait.jpg" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" rel="apple-touch-startup-image">

    <!-- iPad Landscape -->
    <link href="http://www.example.com/mobile/images/apple-startup-iPad-Landscape.jpg" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" rel="apple-touch-startup-image">

    <!-- iPad Portrait (Retina) -->
    <link href="http://www.example.com/mobile/images/apple-startup-iPad-RETINA-Portrait.jpg" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">

    <!-- iPad Landscape (Retina) -->
    <link href="http://www.example.com/mobile/images/apple-startup-iPad-RETINA-Landscape.jpg" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">


    <title>Drawl</title>

    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>


    <script type="text/javascript" charset="utf-8">
     $( document ).ready(function() {

        var portraitLock = screen.mozLockOrientation("portrait");

        // if loads on a browser...
        if ($( window ).width() > 480 ) {
          //$("body").html("This app only works on a mobile device!  Load this URL on your mobile device!");
        }

        // detect a mobile device
        var isMobile = {
            Android: function() {
                return navigator.userAgent.match(/Android/i);
            },
            BlackBerry: function() {
                return navigator.userAgent.match(/BlackBerry/i);
            },
            iOS: function() {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i);
            },
            Opera: function() {
                return navigator.userAgent.match(/Opera Mini/i);
            },
            Windows: function() {
                return navigator.userAgent.match(/IEMobile/i);
            },
            any: function() {
                return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
            }
        };

        if (isMobile.iOS()) {

          //$("#container").hide();

          // scroll down nav on IOS
          // window.scrollTo(0, 1);

          if(window.navigator.standalone == true){
            // alert("installed home screen!");
            // this is the real UI here

            $("#container").show();
          } else {
            //$("body").html("<p>Install this app!</p>");
          }

        }

        // FFOS specific
        if ($( window ).width() > 320 ) {
          //screensize large
          $("#sketchpad").attr("width", "640");
          $("#sketchpad").attr("height", "784");
          //alert("large");
          //$("body").html("This app only works on a mobile device!  Load this URL on your mobile device!");
        } else {
          //screensize small
          //alert("small");
          $("#sketchpad").attr("width", "320");
          $("#sketchpad").attr("height", "456");
        }
        // if screensize is smaller
        // then canvas width 320
        // and height 392
        // also reset the toolbar size to be @2x
        // and the buttons to be at @2x
        // and the up and down height animations

      });
    </script>

</head>

<body>

	<!-- install app from URL -->
	<!-- <button id="install"><span class="icon icon-add">add</span></button> -->

  <div id="container">

      <div id="top">
        <canvas id="sketchpad">
          Sorry, your browser is not supported.
        </canvas>
      </div>

      <footer id="footer">
        <nav id="maintoolbar" class="navbar navbar-default navbar-fixed-bottom" role="navigation">
          <div class="col-xs-9">
            <button type="button" class="btn btn-default" id="btn-pencil">P</button>
            <!-- <button type="button" class="btn btn-default"id="spraycan">Spr</button> -->
            <button type="button" class="btn btn-default" id="btn-colorpicker">C</button>
            <button type="button" class="btn btn-default" id="btn-eraser">E</button>
            <button type="button" class="btn btn-default" id="btn-brushsize">S</button>
          </div>
          <div class="col-xs-3">
            <button type="button" class="btn btn-default pull-right" id="btn-done">Done</button>
          </div>
        </nav>

        <div id="done-panel" class="panel panel-default">
          <div class="panel-heading">What do you want to do?</div>
          <div class="panel-body">
            <button type="button" class="btn btn-primary btn-lg btn-block" id="addDrawing" >Save</button>
            <button type="button" class="btn btn-default btn-lg btn-block" id="btn-new">Clear</button>
            <button type="button" class="btn btn-default btn-lg btn-block" id="btn-cancel" href="">Cancel</button>
          </div>
        </div>

        <div class="toolbar" id="colorpicker">
            <div class="col-xs-12">
              <button class="btn btn-default" id="color-zero">b</button>
              <button class="btn btn-default" id="color-one">r</button>
              <button class="btn btn-default" id="color-two">o</button>
              <button class="btn btn-default" id="color-three">y</button>
              <button class="btn btn-default" id="color-four">g</button>
              <button class="btn btn-default" id="color-five">b</button>
              <button class="btn btn-default" id="color-six">i</button>
              <button class="btn btn-default" id="color-seven">v</button>
            </div>
        </div>

        <!-- Brush adjustments -->
        <div class="toolbar" id="brushsize">
            <div class="col-xs-12">
              <!-- <p>Brush size</p> -->
              <div id="brushStrokeSize" class="slider slider-horizontal" style="width: 240px;"></div>
              <p>
                <button class="btn btn-default" id="roundbrush">r</button>
                <button class="btn btn-default"id="squarebrush">s</button>
              </p>

              <!-- <p>Brush softness</p> -->
              <!-- <div id="brushSoftness" class="slider slider-horizontal" style="width: 140px;"></div> -->

              <!-- <p>Opacity</p>
              <div id="brushOpacity" class="slider slider-horizontal" style="width: 140px;"></div> -->
            </div>
        </div>

        <!-- Modal -->
          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title">Modal title</h4>
                </div>
                <div class="modal-body">
                  <img src="" id="theimage">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary">Save changes</button>
                </div>
              </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
          </div><!-- /.modal -->


      </footer>

  </div> <!-- end container -->


  <script type="text/javascript" src="js/base.js"></script>
  <script type="text/javascript" src="js/webapp.js"></script>
  <script type="text/javascript" src="js/offline.js"></script>
  <script type="text/javascript" src="js/draw.js"></script>
  <script type="text/javascript" src="js/toolbar.js"></script>
  <script type="text/javascript" src="js/bootstrap-slider.js"></script>
  <script type="text/javascript" src="js/modernizr.js"></script>
  <script type="text/javascript" src="js/jquery.hammer.min.js"></script>
  <script type="text/javascript" src="js/modal.js"></script>

  <!--
      Loosely based on fxosstub: https://github.com/Jaxo/fxosstub
  -->

  <script type="text/javascript" charset="utf-8">

    // detect a mobile device
    var isMobile = {
        Android: function() {
            return navigator.userAgent.match(/Android/i);
        },
        BlackBerry: function() {
            return navigator.userAgent.match(/BlackBerry/i);
        },
        iOS: function() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i);
        },
        Opera: function() {
            return navigator.userAgent.match(/Opera Mini/i);
        },
        Windows: function() {
            return navigator.userAgent.match(/IEMobile/i);
        },
        any: function() {
            return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
        }
    };


    // Save button
    //$('#btn-save').click(function(){

      //listContents('pictures');

      //var canvas = document.getElementById("sketchpad"); // get the canvas
      //var image = canvas.toDataURL("image/png"); // convert canvas to an image, .png
      //window.open(image);

      //var storage = navigator.getDeviceStorage("pictures");
      //var file   = new Blob([image], {type: "image/*"});
      //var request = storage.addNamed(file, "my-file.png");
      //console.log(request);

      //if (isMobile.iOS()) {
        //var ajax = new XMLHttpRequest();
        //ajax.open("POST",'script.php',false);
        //ajax.setRequestHeader('Content-Type', 'application/upload');
        //ajax.send(image);
      //}

      //$( "#done-panel" ).animate({
       // bottom: "-240"
      //}, 200);
    //});


    //this works only for iOS/Android
    if (isMobile.any()) {

      // Hammertime onRELEASE, move the toolbar back up
      var release = document.getElementById('sketchpad');
      var hammertime_release = Hammer(release).on("release", function(event) {
          $("#maintoolbar").animate({
            bottom: "0"
          }, 200);
          $( "#brushsize.toolbar" ).animate({
              bottom: "+=200"
          }, 200);
          $( "#colorpicker.toolbar" ).animate({
              bottom: "+=240"
          }, 200);
      });

      // Hammertime onTOUCH, move the toolbar down
      var touch = document.getElementById('sketchpad');
      var hammertime_hold = Hammer(touch).on("touch", function(event) {
          // move the toolbar down
          $("#maintoolbar").animate({
            bottom: "-100"
          }, 200);
          // move the brushsize toolbar down if it's up
          $( "#brushsize.toolbar" ).animate({
              bottom: "-=200"
          }, 200);
          $( "#colorpicker.toolbar" ).animate({
              bottom: "-=240"
          }, 200);
      });

    } else {

      // FFOS specific
      if ($( window ).width() > 320 ) {
        //screensize large
        //touch events for FFOS
        canvas.addEventListener('touchstart',function(event){
          $( "#maintoolbar" ).animate({
              bottom: "-80"
            }, 200);
          $( "#brushsize.toolbar" ).animate({
              bottom: "-=200"
          }, 200);
          $( "#colorpicker.toolbar" ).animate({
              bottom: "-=240"
          }, 200);
        }, false);

        canvas.addEventListener('touchend',function(event){
          $( "#maintoolbar" ).animate({
              bottom: "0"
            }, 200);
          // move the brushsize toolbar down if it's up
          $( "#brushsize.toolbar" ).animate({
              bottom: "+=200"
          }, 200);
          $( "#colorpicker.toolbar" ).animate({
              bottom: "+=240"
          }, 200);
        }, false);

      } else {
        //screensize small
        //touch events for FFOS
        canvas.addEventListener('touchstart',function(event){
          $( "#maintoolbar" ).animate({
              top: "500"
            }, 200);
          $( "#brushsize.toolbar" ).animate({
              bottom: "-=200"
          }, 200);
          $( "#colorpicker.toolbar" ).animate({
              bottom: "-=240"
          }, 200);
        }, false);

        canvas.addEventListener('touchend',function(event){
          $( "#maintoolbar" ).animate({
              top: "396"
            }, 200);
          // move the brushsize toolbar down if it's up
          $( "#brushsize.toolbar" ).animate({
              bottom: "+=200"
          }, 200);
          $( "#colorpicker.toolbar" ).animate({
              bottom: "+=240"
          }, 200);
        }, false);
      }

    }

    // move toolbar up and down by tapping it
    //function moveupToolbar() { }
    //function movedownToolbar() { }

    // Change the Brush Softness


    // Change the Brush Opacity
    //get the alpha of the current brush and asjust it

    // Change the Brush Stroke
    var BrushChange = function() {
      context.lineWidth = brushStroke.getValue();
    };

    var brushStroke = $('#brushStrokeSize').slider({
      tooltip: "hide"
    })
                    .on('slide', BrushChange)
                    .data('slider');


  </script>

</body>
</html>
